<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Ultra Realistic AR Grid</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000; /* AR başlamadan önceki renk */
            font-family: sans-serif;
        }
        /* AR Başlatma Butonunun Stili (Three.js otomatik ekleyecek ama biz özelleştirebiliriz) */
        #ar-button-container {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            z-index: 100;
            pointer-events: none; /* Tıklamalar alttaki butona geçsin */
        }
        /* Bilgilendirme metni */
        #info {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            color: white;
            background: rgba(0,0,0,0.5);
            padding: 5px;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <div id="info">AR Modu: Etrafında 3D bir ızgara belirecek.</div>
    <div id="ar-button-container"></div>

    <script type="module">
        import * as THREE from 'https://unpkg.com/three@0.157.0/build/three.module.js';
        import { ARButton } from 'https://unpkg.com/three@0.157.0/examples/jsm/webxr/ARButton.js';

        let camera, scene, renderer;
        let gridObject;

        init();

        function init() {
            const container = document.createElement('div');
            document.body.appendChild(container);

            // 1. SAHNE (SCENE)
            scene = new THREE.Scene();
            // ÖNEMLİ: Arka planı 'null' yapıyoruz ki kamera görüntüsü arkada gözüksün.
            scene.background = null;

            // 2. KAMERA
            // WebXR'da kamera pozisyonu otomatik yönetilir.
            // FOV (70) ve diğer ayarlar başlangıç için standarttır.
            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 20);

            // 3. IŞIKLANDIRMA (Wireframe için şart değil ama "realistic" his için hafif bir ortam ışığı ekleyelim)
            const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
            light.position.set(0.5, 1, 0.25);
            scene.add(light);

            // 4. RENDERER (Görüntü Motoru)
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true }); // alpha: true önemli (şeffaflık için)
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            // WebXR'ı aktif ediyoruz. Bu sihirli satır.
            renderer.xr.enabled = true; 
            container.appendChild(renderer.domElement);

            // 5. AR BUTONU EKLEME
            // Three.js'in hazır AR butonu. Tıklandığında kamera izni ister ve AR moduna geçer.
            const arButton = ARButton.createButton(renderer, { 
                requiredFeatures: ['hit-test'], // Gelişmiş yüzey algılama için (isteğe bağlı)
                optionalFeatures: ['dom-overlay'], 
                domOverlay: { root: document.body } 
            });
            document.getElementById('ar-button-container').appendChild(arButton);
            

            // --- 3D IZGARA OBJESİNİ OLUŞTURMA ---
            // Daha gerçekçi olması için devasa bir oda yerine,
            // odanın ortasında duran, sanki fiziksel bir nesneymiş gibi görünen bir küp yapalım.
            
            // Boyut: 1 metre x 1 metre x 1 metre
            const geometry = new THREE.BoxGeometry(1, 1, 1, 10, 10, 10); // Segmentleri artırdık, daha sıkı ızgara.
            
            // Materyal: Parlak beyaz çizgiler
            const material = new THREE.MeshBasicMaterial({
                color: 0xffffff,
                wireframe: true,
                transparent: true,
                opacity: 0.9
            });

            gridObject = new THREE.Mesh(geometry, material);

            // POZİSYONLAMA:
            // WebXR başladığında kamera (0,0,0) noktasındadır.
            // Objeyi Z ekseninde -1.5 metre (yani karşımıza, 1.5 metre uzağa) koyuyoruz.
            gridObject.position.set(0, 0, -1.5);
            
            // Hafif bir açı verelim ki daha havalı dursun
            gridObject.rotation.x = THREE.MathUtils.degToRad(15);
            gridObject.rotation.y = THREE.MathUtils.degToRad(45);

            scene.add(gridObject);

            // PENCERE BOYUTU DEĞİŞİRSE
            window.addEventListener('resize', onWindowResize);

            // ANIMASYON DÖNGÜSÜNÜ BAŞLAT
            // WebXR'da 'requestAnimationFrame' yerine bu kullanılır.
            renderer.setAnimationLoop(render);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // HER KAREDE YAPILACAKLAR
        function render() {
            // İstersen objeyi yavaşça kendi etrafında döndürebilirsin:
            // if (gridObject) {
            //     gridObject.rotation.y += 0.005;
            // }

            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
